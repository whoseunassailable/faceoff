<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Faceoff • Upload Your Design</title>

    <!-- Base styles -->
    <link rel="stylesheet" href="./css/base.css" />
    <link rel="stylesheet" href="./css/upload_your_own_design.css" />

    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div class="empty-container">
      <div class="topline"></div>
      <div class="topcurve"></div>

      <h1 class="upload-heading">Upload Your Design</h1>
      <p class="upload-sub">Share your masterpiece and enter the arena.</p>

      <form class="upload-wrap" id="uploadForm" novalidate>
        <!-- Dropzone -->
        <div class="panelish">
          <div
            class="dropzone"
            id="dropzone"
            tabindex="0"
            role="button"
            aria-label="Upload image by clicking or dragging a file here"
          >
            <strong>Drag & drop</strong> your image here, or
            <u>click to browse</u>.
            <small
              >Accepted: JPG, PNG, GIF • Max 10MB • Recommended ≥ 1024px
              wide</small
            >
            <input
              type="file"
              id="fileInput"
              class="hidden-input"
              accept="image/*"
              aria-hidden="true"
            />
          </div>

          <!-- Preview -->
          <div class="preview" id="preview" style="display: none">
            <img id="previewImg" alt="Selected artwork preview" />
            <div class="meta" id="meta"></div>
          </div>

          <div class="error" id="fileError" aria-live="polite"></div>
          <div class="progress-wrap" id="progressWrap" aria-hidden="true">
            <div class="progress-track">
              <div class="progress-bar" id="progressBar"></div>
            </div>
          </div>
        </div>

        <!-- Details -->
        <div class="panelish">
          <div class="row">
            <div class="field">
              <label for="title">Title</label>
              <input
                type="text"
                id="title"
                name="title"
                placeholder="e.g., Dawn Over Florence"
                required
              />
              <div class="error" id="titleError" aria-live="polite"></div>
            </div>

            <div class="field">
              <label for="category">Category</label>
              <select id="category" name="category" required>
                <option value="">Choose a category…</option>
                <option>Painting</option>
                <option>Illustration</option>
                <option>Photography</option>
                <option>3D / Render</option>
                <option>Typography</option>
              </select>
              <div class="error" id="categoryError" aria-live="polite"></div>
            </div>
          </div>

          <div class="field">
            <label for="description">Description (optional)</label>
            <textarea
              id="description"
              name="description"
              placeholder="Tell the story behind your piece…"
            ></textarea>
          </div>

          <div class="field">
            <label for="tags">Tags (comma-separated)</label>
            <input
              type="text"
              id="tags"
              name="tags"
              placeholder="renaissance, chiaroscuro, portrait"
            />
          </div>

          <div class="checkbox">
            <input type="checkbox" id="rights" required />
            <label for="rights">
              I own the rights to this work or have permission to submit it and
              it complies with the Terms.
            </label>
          </div>
          <div class="checkbox">
            <input type="checkbox" id="agree" required />
            <label for="agree">
              I agree to the
              <a href="terms.html" target="_blank" rel="noopener"
                >Terms of Use</a
              >
              and
              <a href="privacy.html" target="_blank" rel="noopener"
                >Privacy Policy</a
              >.
            </label>
          </div>

          <div class="actions">
            <button type="button" class="btn secondary" id="resetBtn">
              Reset
            </button>
            <button type="submit" class="btn" id="submitBtn">Submit</button>
          </div>
        </div>
      </form>
      <custom-footer></custom-footer>
    </div>
    <script src="../js/custom-footer.js" type="module"></script>
    <script>
      // ===== Config =====
      const MAX_MB = 10;
      const ACCEPTED_TYPES = ["image/jpeg", "image/png", "image/gif"];

      // ===== Elements =====
      const dropzone = document.getElementById("dropzone");
      const fileInput = document.getElementById("fileInput");
      const fileError = document.getElementById("fileError");
      const preview = document.getElementById("preview");
      const previewImg = document.getElementById("previewImg");
      const meta = document.getElementById("meta");
      const progressWrap = document.getElementById("progressWrap");
      const progressBar = document.getElementById("progressBar");
      const form = document.getElementById("uploadForm");
      const resetBtn = document.getElementById("resetBtn");
      const titleEl = document.getElementById("title");
      const titleError = document.getElementById("titleError");
      const categoryEl = document.getElementById("category");
      const categoryError = document.getElementById("categoryError");

      // ===== Helpers =====
      function bytesToSize(bytes) {
        const units = ["B", "KB", "MB", "GB"];
        let i = 0;
        while (bytes >= 1024 && i < units.length - 1) {
          bytes /= 1024;
          i++;
        }
        return bytes.toFixed(1) + " " + units[i];
      }

      function resetForm() {
        form.reset();
        fileInput.value = "";
        preview.style.display = "none";
        previewImg.src = "";
        meta.innerHTML = "";
        fileError.textContent = "";
        titleError.textContent = "";
        categoryError.textContent = "";
        progressWrap.style.display = "none";
        progressBar.style.width = "0%";
      }

      function validateFile(file) {
        if (!file) return "Please choose an image.";
        if (!ACCEPTED_TYPES.includes(file.type))
          return "Unsupported file type. Use JPG, PNG, or GIF.";
        const mb = file.size / (1024 * 1024);
        if (mb > MAX_MB)
          return `File is too large (${mb.toFixed(1)}MB). Max ${MAX_MB}MB.`;
        return "";
      }

      function showPreview(file) {
        preview.style.display = "grid";
        previewImg.src = URL.createObjectURL(file);
        meta.innerHTML = `
          <div><strong>Name:</strong> ${file.name}</div>
          <div><strong>Type:</strong> ${file.type || "n/a"}</div>
          <div><strong>Size:</strong> ${bytesToSize(file.size)}</div>
          <div id="dimNote" style="opacity:.9;">Reading image size…</div>
        `;

        // Read dimensions (optional)
        const img = new Image();
        img.onload = () => {
          const dim = document.getElementById("dimNote");
          if (dim)
            dim.textContent = `Dimensions: ${img.naturalWidth}×${img.naturalHeight}px`;
          URL.revokeObjectURL(img.src);
        };
        img.src = URL.createObjectURL(file);
      }

      function handleFile(file) {
        fileError.textContent = "";
        const err = validateFile(file);
        if (err) {
          fileError.textContent = err;
          preview.style.display = "none";
          return;
        }
        showPreview(file);
      }

      // ===== Dropzone Events =====
      dropzone.addEventListener("click", () => fileInput.click());
      dropzone.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          fileInput.click();
        }
      });

      ["dragenter", "dragover"].forEach((evt) =>
        dropzone.addEventListener(evt, (e) => {
          e.preventDefault();
          e.stopPropagation();
          dropzone.classList.add("dragover");
        })
      );
      ["dragleave", "drop"].forEach((evt) =>
        dropzone.addEventListener(evt, (e) => {
          e.preventDefault();
          e.stopPropagation();
          dropzone.classList.remove("dragover");
        })
      );
      dropzone.addEventListener("drop", (e) => {
        const file = e.dataTransfer.files && e.dataTransfer.files[0];
        if (file) handleFile(file);
      });

      fileInput.addEventListener("change", (e) => {
        const file = e.target.files && e.target.files[0];
        if (file) handleFile(file);
      });

      resetBtn.addEventListener("click", resetForm);

      // ===== Submit (mock upload) =====
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Basic field validation
        let valid = true;
        titleError.textContent = "";
        categoryError.textContent = "";

        if (!fileInput.files[0]) {
          fileError.textContent = "Please choose an image to upload.";
          valid = false;
        }
        if (!titleEl.value.trim()) {
          titleError.textContent = "Please enter a title.";
          valid = false;
        }
        if (!categoryEl.value) {
          categoryError.textContent = "Please choose a category.";
          valid = false;
        }

        const rights = document.getElementById("rights");
        const agree = document.getElementById("agree");
        if (!rights.checked || !agree.checked) {
          fileError.textContent =
            "Please confirm rights and agree to Terms & Privacy.";
          valid = false;
        }

        if (!valid) return;

        // Fake progress (replace with real upload)
        progressWrap.style.display = "block";
        progressWrap.setAttribute("aria-hidden", "false");
        progressBar.style.width = "0%";

        // Example: construct form data (for your actual API)
        const fd = new FormData();
        fd.append("file", fileInput.files[0]);
        fd.append("title", titleEl.value.trim());
        fd.append("category", categoryEl.value);
        fd.append(
          "description",
          document.getElementById("description").value.trim()
        );
        fd.append("tags", document.getElementById("tags").value.trim());

        // TODO: Replace the mock loop with a real fetch() to your backend:
        // const resp = await fetch("/api/uploads", { method: "POST", body: fd });

        // Simulated progress
        let p = 0;
        const tick = () => {
          p = Math.min(100, p + Math.random() * 18);
          progressBar.style.width = p.toFixed(0) + "%";
          if (p < 100) requestAnimationFrame(tick);
          else {
            setTimeout(() => {
              alert("Upload complete! Your design is queued for Faceoff.");
              resetForm();
              // Optionally redirect to voting or your gallery:
              // location.href = "start-voting.html";
            }, 250);
          }
        };
        requestAnimationFrame(tick);
      });
    </script>
  </body>
</html>
